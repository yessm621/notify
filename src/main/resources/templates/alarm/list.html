<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Title</title>
</head>
<body>

<h2>ğŸ”” ì‹¤ì‹œê°„ ì•Œë¦¼</h2>
<!-- ì•Œë¦¼ ëª©ë¡ -->
<ul id="alarmList"></ul>

</body>
<script>
  // ì•Œë¦¼ ë¦¬ìŠ¤íŠ¸ë¥¼ ë¹„ë™ê¸°ë¡œ ë‹¤ì‹œ ë¶ˆëŸ¬ì˜¤ê¸°
  function fetchAlarms() {
    fetch('/user/alarm/list')
      .then(res => res.json())
      .then(data => {
        const alarmList = document.getElementById("alarmList");
        alarmList.innerHTML = ''; // ê¸°ì¡´ ì•Œë¦¼ ì§€ì›€
        data.forEach(alarm => {
          const li = document.createElement('li');
          li.textContent = alarm.text;
          alarmList.appendChild(li);
        });
      })
      .catch(err => {
        console.error('ì•Œë¦¼ ë¡œë“œ ì‹¤íŒ¨', err);
      });
  }

  // SSE ì—°ê²°
  const sse = new EventSource('/user/alarm/subscribe');

  sse.addEventListener("open", () => {
    console.log("âœ… SSE ì—°ê²° ì„±ê³µ");
    fetchAlarms(); // ì—°ê²°ëœ ì‹œì ì— ìµœì´ˆ í˜¸ì¶œ
  });

  sse.addEventListener("alarm", (event) => {
    console.log("ğŸ“¨ ìƒˆë¡œìš´ ì•Œë¦¼ ìˆ˜ì‹ :", event.data);
    fetchAlarms(); // í˜„ì¬ í˜ì´ì§€ ë‹¤ì‹œ ë¶ˆëŸ¬ì˜¤ê¸°
  });

  sse.addEventListener("error", (event) => {
    console.error("âŒ SSE ì˜¤ë¥˜", event);
    sse.close();
  });

  fetchAlarms();
</script>
</html>
